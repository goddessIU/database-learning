# chapter2
## database schema
类似于是数据库的结构、定义
student(ID, name, phone) 算是schema， 就是数据库的attribute和他们的domain

## database instances
数据库的快照

relation如果是变量，schema是变量的类型和定义，instance是值

## keys
### superkey
superkey可以区别出不同的tuple， 如果id可以区别出，id+name也是superkey， name是无关的

### candidate key
这个superkey子集不是superkey，就是candidate key

### primary key

### foreign key
该属性是另一个relation的primary key

## relational algebra(P53)
selection \ projection \ natural join \ cartesian product \ union 


# chapter3
## SQL 
### parts of SQL
1. data-definition language DDL: define relation schemas, deleting relations and modifying relation schemas
2. data-manipulation language(DML):数据增删改查
3. Integrity
4. view definition
5. transaction control
6. embedded sql and dynamic sql
7. authorization

## DDL(P60)
### built-in types
char\ varchar\int\smallint\numeric\real, double precision \ float(P61)



# chapter4
## sql进阶部分
### view(P123)
从安全角度考虑，可能使用者不应该接触到数据库的全部，比如A不应该得到relation中salary这一attribute的值，所以可以用视图(不包含salary)，让使用者用这个视图
materialized views可以在relation改变时随着改变

### transactions(P129)
需要补充学习

### integrity constraints(P131)
constraints on a single relation:
not null, unqiue primary key, check clause
referential integiry:
有学到cascade、 set null\ set default等
comlex check conditions and assertions(这块没太懂)

### SQL Data types and schemas(P138)
1. time types , date
date\ time\ tiemstamp
相关的函数:current_time, current_date\ current_timestamp等

2. default value

3. index creation
create index studentID_index on student(ID)

### large-Object types
SQL provides large-object datatypes for character data(clob) and binary data(blob), lob stand for 'large-object'

一般不会直接获取整个数据，因为太大了。而是通过应用的编程语言，一部分一部分获取

### user-defined types
two forms : distinct types, structured data types
建立新的types：
create type Dollars AS numeric(12, 2) final;
and then , we use the newly type:
CREATE TABLE(budget Dollars);

### create table extensions
为了拥有一样的schema，可以如下
create table temp_instructor like instructor
或者
create table t1 AS (
    SELECT * 
    FROM instructor
    WHERE ...
) 
With data;

### schemas, catalogs, and environments(P144)
书上划红线部分很清楚。
为了避免relation名称上的冲突，通常是三级的设置，先是catalogs(or database), 然后schema，然后relation。用户通过密码账号连接database system， 然后他拥有一个默认的catalog和schema
为了区别relation，使用如下方式
catalog5.univ_schema.course

##### 疑惑： 一个user能有多个catalog吗？

### authorization
authorization include：
authorization to read data\ insert new data\ update data\ delete data,每次都需要先检查是否有这个权利
authorization on the database schema: create, modify, drop relations

#### granting and revoking of privileges
privileges 包括select insert  update delete
relation的建立者拥有所有privilege

DDL语句可以授权或者撤销特权：
```sql
grant <privilege>
on <relation name or view name>
to <user/role list>

for example:
grant select on department to Amit, satoshi;
```
有某项权利的用户并没有权利将该权利再赋予其他人

如果要revoke
```sql
revoke <privilege list>
on <relation name or view name>
from <user/role list>

revoke select on department from amit;
revoke update(budget) on department from amit;
```


#### roles
就是user是某种角色，对这种角色进行管理，如果是instrutor这种角色， 我们可以让instructor这种角色拥有哪些权利，这样该role的user就拥有了相应权利

```sql
创建role
create role instructor;

像赋予user权利一样，赋予权利给role
grant selecct on takes to instructor;

赋予user role
grant dean to Amit;
create role dean;
grant instructor to dean;
grant dean to satoshi;
```


#### authorization on views
view 的创建者对于view的权利不能超过他已有的权利

#### authorizations on schema
schema的owner有对于schema操作的权利，如creating or deleting relations, adding or dropping attributes, adding or dropping indices

然而，有一个references权利允许使用者在创建relation时去创建外键，如下
```sql
grant references (dept_name) on department to Mariano;
```

#### transfer of privilege
如下，可以让amit在接受select权利同时，可以将自己权利转给他人
```sql
grant select on department to Amit with grant options;
```

authorization graph(P151)

#### revoking of privileges
cascading revocation:数据库管理者撤回某项权利时。如root给U2某个权利，U2又把权利给了U3，需要把这些全部撤回，就称为这个名词。一般也是默认的行为
严格的语句如下
```sql
revoke  select on department from amit, satoshi restrict;
```
还有
```sql
revoke grant option for select on department from amit;
```

但有些时候，我们不希望U3权利也被收回，所以sql提供通过role方式赋予权利，这样可以避免级联收回权利
```sql
只需在授权语句后面加上
granted by current_role
```

# chapter5
## sql和编程语言结合
两种方式使编程语言运用sql：
1. dynamic sql：在运行时由编程语言构建sql，jdbc和odbc是连接数据库的两个API
2. embedded sql:用sql写完，然后会先转换成编程语言

### ODBC
Open Database Connectivity (ODBC) is a standard application programming interface (API) for accessing database management systems (DBMS).The designers of ODBC aimed to make it independent of database systems and operating systems.[citation needed] An application written using ODBC can be ported to other platforms, both on the client and server side, with few changes to the data access code.(维基百科)

<strong>还不是那么明白，只是大概明白。具体怎么用，怎么回事，以后深入</strong>

### embedded sql
为了让预处理程序识别，通常这么写sql
```sql
EXEC SQL <embedded SQL statement>;
```

## functions and procedures
构建了function
```sql
create function dept_count(dept_name varchar(20))
    returns integer
    begin
    declare d_count integer;
        select count(*) into 
        from instructor
        where instructor.dept_name = dept_name
    return d_count;
    end
```

使用function
```sql
select dept_name, budget
from department
where dept_count(dept_name) > 12;
```

table function，返回table
```sql
create function instructor_of(dept_name varchar(20))
    returns table (
        ID varchar(5),
        name varchar(20),
        dept_name varchar(20),
        salary numeric(8, 2)
    ) 
return table 
    (
        select ID, name, dept_name, salary
        from instructor
        where instructor.dept_name = instructor_of.dept_name
    );
```

使用
```sql
select * 
from table(instructor_of('Finance'));
```

procedure
```sql
create procedure dept_count_proc(in dept_name varchar(20), out d_count integer)
    begin 
        select count(*) into d_count
        from instructor
        where instructor.dept_name = dept_count_proc.dept_name
    end
```

调用
```sql
declare d_count integer;
call dept_count_proc('Physics', d_count);
```

### language constructs fro procedures and functions(P178)
```sql
while boolean expression do 
    sequence of statements;
end while

repeat 
    sequence of statements;
until boolean expression 
end repeat


declare n integer default 0;
for r as
    select budget from department
    where dept_name = 'Music'
do 
    set n = n - r.budget
end for

等等
```